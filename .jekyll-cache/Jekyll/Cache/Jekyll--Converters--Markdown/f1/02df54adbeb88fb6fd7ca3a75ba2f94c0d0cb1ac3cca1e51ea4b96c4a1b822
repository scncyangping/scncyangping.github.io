I"ï <h3 id="hdfsåŸºç¡€">HDFSåŸºç¡€</h3>
<h5 id="hadoop-distributed-file-system">Hadoop Distributed File System</h5>
<ul>
  <li>åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ</li>
  <li>è¿è¡Œåœ¨ commodity hardware</li>
  <li>fault-tolerant é«˜å®¹é”™</li>
  <li>éƒ¨ç½²åœ¨å»‰ä»·çš„(low-cost hardware)çš„æœºå™¨ä¸Š</li>
  <li>é«˜ååé‡ high throughput</li>
  <li>é€‚ç”¨äºå¤§æ•°æ®é‡</li>
</ul>

<h5 id="æ™®é€šæ–‡ä»¶ç³»ç»Ÿ">æ™®é€šæ–‡ä»¶ç³»ç»Ÿ</h5>

<ul>
  <li>ç›®å½•ç»“æ„</li>
  <li>å­˜åœ¨çš„æ˜¯æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹</li>
  <li>å¯¹å¤–æä¾›æœåŠ¡: åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤ã€æŸ¥çœ‹ã€ç§»åŠ¨</li>
</ul>

<h5 id="æ™®é€šæ–‡ä»¶ç³»ç»Ÿ-vs-åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ">æ™®é€šæ–‡ä»¶ç³»ç»Ÿ VS åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ</h5>

<ul>
  <li>å•æœº  é›†ç¾¤</li>
  <li>åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿèƒ½å¤Ÿæ¨ªè·¨Nä¸ªæœºå™¨</li>
</ul>

<h4 id="hdfså‰æå’Œè®¾è®¡ç›®æ ‡">HDFSå‰æå’Œè®¾è®¡ç›®æ ‡</h4>

<ul>
  <li>Hardware Failure(ç¡¬ä»¶é”™è¯¯) æ˜¯å¾ˆå¸¸è§çš„
    <ol>
      <li>æ¯ä¸ªæœºå™¨åªå­˜å‚¨æ–‡ä»¶çš„éƒ¨åˆ†æ•°æ®,blocksize=128M,blockå­˜æ”¾åœ¨ä¸åŒçš„æœºå™¨ä¸Šæ¥å®¹é”™</li>
    </ol>
  </li>
  <li>Streaming Data Access æµå¼æ•°æ®è®¿é—®</li>
  <li>Large Data Sets å¤§è§„æ¨¡æ•°æ®é›†</li>
  <li>Moving Computation is Cheaper than Moving Data ç§»åŠ¨è®¡ç®—æ¯”ç§»åŠ¨æ•°æ®æ›´åˆ’ç®—</li>
</ul>

<h4 id="hdfs-æ¶æ„">HDFS æ¶æ„</h4>

<h5 id="namenode-and-datanodes">NameNode and DataNodes</h5>

<ul>
  <li>ä¸»ä»æ¶æ„
    <ol>
      <li>ä¸»èŠ‚ç‚¹ç®¡ç†NameSpace(è¿™é‡Œå¯ä»¥ç†è§£ä¸ºæ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿ)</li>
      <li>ä¸»èŠ‚ç‚¹æä¾›å¯¹å®¢æˆ·ç«¯çš„è®¿é—® (å¯¹æ–‡ä»¶çš„CRUDåŠç®¡ç†æ–‡ä»¶ä¸DataNodeä¹‹é—´çš„æ˜ å°„)</li>
      <li>æ•°æ®èŠ‚ç‚¹æä¾›æ•°æ®å­˜å‚¨åŠŸèƒ½</li>
      <li>ä¸€ä¸ªæ–‡ä»¶è¢«æ‹†åˆ†ä¸ºå¤šä¸ªblock,å­˜åœ¨ä¸€ç³»åˆ—çš„DataNodeä¸Š,ç”¨äºå®¹é”™</li>
    </ol>
  </li>
  <li>å‰¯æœ¬æœºåˆ¶
    <ol>
      <li>è®²ä¸€ä¸ªå¤§æ–‡ä»¶æ°›åˆ†ä¸ºå¤šä¸ªblock,é™¤äº†æœ€åä¸€ä¸ªï¼Œæ¯ä¸ªå—å¤§å°ç›¸åŒ</li>
      <li>æ–‡ä»¶çš„å‰¯æœ¬æ•°é‡å¯ä»¥åœ¨åˆ›å»ºçš„æ—¶å€™æŒ‡å®š</li>
    </ol>
  </li>
</ul>

<h6 id="å‰¯æœ¬æ‘†æ”¾ç­–ç•¥">å‰¯æœ¬æ‘†æ”¾ç­–ç•¥</h6>

<p>é»˜è®¤ ç›¸åŒrackå†…æ–‡ä»¶ä¼ è¾“å°±ä¼šå¿«ä¸€äº›</p>

<ol>
  <li>æœ¬rackçš„ä¸€ä¸ªèŠ‚ç‚¹ä¸Š</li>
  <li>å¦å¤–ä¸€ä¸ªrackçš„èŠ‚ç‚¹ä¸Š</li>
  <li>ä¸2ç›¸åŒçš„rackçš„å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹ä¸Š</li>
</ol>

<p>è¿˜æœ‰å…¶ä»–çš„æ–¹å¼ç‰ˆæœ¬ä¸åŒå¯èƒ½ä¸åŒ</p>
<ol>
  <li>æœ¬rackçš„ä¸€ä¸ªèŠ‚ç‚¹ä¸Š</li>
  <li>æœ¬rackçš„å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Š</li>
  <li>å¦å¤–ä¸€ä¸ªrackçš„èŠ‚ç‚¹ä¸Š</li>
</ol>

<h4 id="å®¢æˆ·ç«¯å†™æ•°æ®åˆ°hdfsçš„æµç¨‹">å®¢æˆ·ç«¯å†™æ•°æ®åˆ°HDFSçš„æµç¨‹</h4>

<ol>
  <li>å®¢æˆ·ç«¯å‘èµ·ä¸Šä¼ æ–‡ä»¶å‘½ä»¤</li>
  <li>namenodeåˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨,å¹¶è¿”å›æ˜¯å¦èƒ½å†™çš„å›å¤,åŒæ—¶,åˆ¤æ–­æ–‡ä»¶çš„å¤§å°è¿”å›å®¢æˆ·ç«¯å†™å…¥åˆ°å“ªå‡ ä¸ªdatanode</li>
  <li>æ ¹æ®æ–‡ä»¶çš„å¤§å°æ‹†åˆ†ä¸åŒçš„block</li>
  <li>æ ¹æ®è¿”å›çš„datanodeçš„æ•°æ®ä¼ è¾“é“¾æ¥,å»ºç«‹è¿æ¥(è¿æ¥å…¶ä¸­ä¸€ä¸ªdatanode,ç”±datanodeå†å»å’Œå…¶ä»–datanodeå»ºç«‹è¿æ¥?)</li>
  <li>æŒ‰é¡ºåºä¼ è¾“blockåˆ°datanode</li>
  <li>é€šçŸ¥namenodeä¼ è¾“å®Œæˆ,è®°å½•å…ƒæ•°æ®ä¿¡æ¯,åç§°ã€blockå­˜æ”¾çš„åœ°æ–¹ç­‰ä¿¡æ¯</li>
</ol>

<h4 id="è¯»æ•°æ®æµç¨‹">è¯»æ•°æ®æµç¨‹</h4>

<ol>
  <li>å®¢æˆ·ç«¯å‘èµ·è¯»è¯·æ±‚åˆ°namenode</li>
  <li>namenodeåˆ¤æ–­æ˜¯å¦å­˜åœ¨ç­‰,è‹¥å­˜åœ¨,è¿”å›æ–‡ä»¶çš„å…ƒæ•°æ®ä¿¡æ¯(æ–‡ä»¶åç§°ã€blockçš„ä¿¡æ¯)</li>
  <li>æŒ‰é¡ºåºå‘é€åˆ°datanodeè¯»å–æ•°æ®</li>
  <li>ç»„è£…,è¿”å›</li>
</ol>

<h4 id="hdfsçš„å…ƒæ•°æ®ç®¡ç†">HDFSçš„å…ƒæ•°æ®ç®¡ç†</h4>

<ul>
  <li>å…ƒæ•°æ® : å…¶å®å°±æ˜¯HDFSçš„ç›®å½•ç»“æ„ä»¥åŠæ¯ä¸ªBLOCKä¿¡æ¯(id,å‰¯æœ¬ç³»æ•°,blockå­˜åœ¨ä»€ä¹ˆåœ°æ–¹)</li>
  <li>å­˜åœ¨ä»€ä¹ˆåœ°æ–¹: å¯¹åº”é…ç½® hadoop.tmp.dir ç›®å½•ä¸‹çš„nameæ–‡ä»¶ä¸‹é¢ fsimageæ–‡ä»¶ä¸­</li>
  <li>æ–‡ä»¶æ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤ç­‰æ“ä½œä¸èƒ½ç›´æ¥æ¯æ¬¡éƒ½æ“ä½œfsimage,æ–‡ä»¶ioå¾ˆæµªè´¹æ€§èƒ½</li>
  <li>checkPoint</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1. å†…å­˜ä¸­æœ‰ä¸€ä¸ªæ ‘å½¢ç»“æ„
2. æ–°å¢æˆ–ä¿®æ”¹ç›´æ¥æ“ä½œå†…å­˜
3. å®šæœŸå°†å†…å­˜ä¸­çš„æ•°æ®å†™å…¥åˆ°fsimageæ–‡ä»¶ä¸­
4. åœ¨æœªåŒæ­¥åˆ°ç£ç›˜çš„æ—¶é—´è¿‡ç¨‹ä¸­,å°†æ‰€æœ‰å¯¹ç£ç›˜çš„æ“ä½œå‘½ä»¤æ”¾åœ¨editsæ—¥å¿—å½“ä¸­
5. æ–°è¿›ç¨‹ - Secondary namenode å°†fsimageåŠ è½½ç£ç›˜æ•°æ®åˆ°å†…å­˜ä¸­,
ç„¶åå°†editsçš„æ“ä½œéƒ½ä½œç”¨åˆ°å†…å­˜ä¸­å»,ç„¶åæ–°ç”Ÿæˆçš„fsimageæ›¿æ¢è°ƒåŸæ¥çš„fsimageæ•°æ®ã€‚
</code></pre></div></div>

<h4 id="å®‰å…¨æ¨¡å¼">å®‰å…¨æ¨¡å¼</h4>

<p>namenodeåœ¨å¯åŠ¨è¿‡ç¨‹ä¸­,ä¼šå…ˆè¿›å…¥ä¸€ä¸ªsafemode çš„çŠ¶æ€,æš‚æ—¶æ˜¯ä¸èƒ½è¿›è¡Œè¯»å†™æ“ä½œçš„,ä¼šæ¥å—æ‰€æœ‰datanodeæ¥æ”¶åˆ°blockçš„ä¿¡æ¯(å¤§æ¦‚30sæ—¶é—´),
å½“æ£€æŸ¥åˆ°æ‰€æœ‰çš„blockçš„å—çš„å‰¯æœ¬æ•°é‡æ˜¯é…ç½®çš„æœ€å°‘æ•°é‡æ—¶,å°±é€€å‡ºå®‰å…¨æ¨¡å¼</p>

<h4 id="hdfs-å‘½ä»¤è¡Œæ“ä½œ">HDFS å‘½ä»¤è¡Œæ“ä½œ</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> hadoop fs [generic options]
        [-appendToFile &lt;localsrc&gt; ... &lt;dst&gt;]
        [-cat [-ignoreCrc] &lt;src&gt; ...]
        [-checksum &lt;src&gt; ...]
        [-chgrp [-R] GROUP PATH...]
        [-chmod [-R] &lt;MODE[,MODE]... | OCTALMODE&gt; PATH...]
        [-chown [-R] [OWNER][:[GROUP]] PATH...]
        [-copyFromLocal [-f] [-p] [-l] &lt;localsrc&gt; ... &lt;dst&gt;]
        [-copyToLocal [-p] [-ignoreCrc] [-crc] &lt;src&gt; ... &lt;localdst&gt;]
        [-count [-q] [-h] [-v] [-x] &lt;path&gt; ...]
        [-cp [-f] [-p | -p[topax]] &lt;src&gt; ... &lt;dst&gt;]
        [-createSnapshot &lt;snapshotDir&gt; [&lt;snapshotName&gt;]]
        [-deleteSnapshot &lt;snapshotDir&gt; &lt;snapshotName&gt;]
        [-df [-h] [&lt;path&gt; ...]]
        [-du [-s] [-h] [-x] &lt;path&gt; ...]
        [-expunge]
        [-find &lt;path&gt; ... &lt;expression&gt; ...]
        [-get [-p] [-ignoreCrc] [-crc] &lt;src&gt; ... &lt;localdst&gt;]
        [-getfacl [-R] &lt;path&gt;]
        [-getfattr [-R] {-n name | -d} [-e en] &lt;path&gt;]
        [-getmerge [-nl] &lt;src&gt; &lt;localdst&gt;]
        [-help [cmd ...]]
        [-ls [-C] [-d] [-h] [-q] [-R] [-t] [-S] [-r] [-u] [&lt;path&gt; ...]]
        [-mkdir [-p] &lt;path&gt; ...]
        [-moveFromLocal &lt;localsrc&gt; ... &lt;dst&gt;]
        [-moveToLocal &lt;src&gt; &lt;localdst&gt;]
        [-mv &lt;src&gt; ... &lt;dst&gt;]
        [-put [-f] [-p] [-l] &lt;localsrc&gt; ... &lt;dst&gt;]
        [-renameSnapshot &lt;snapshotDir&gt; &lt;oldName&gt; &lt;newName&gt;]
        [-rm [-f] [-r|-R] [-skipTrash] &lt;src&gt; ...]
        [-rmdir [--ignore-fail-on-non-empty] &lt;dir&gt; ...]
        [-setfacl [-R] [{-b|-k} {-m|-x &lt;acl_spec&gt;} &lt;path&gt;]|[--set &lt;acl_spec&gt; &lt;path&gt;]]
        [-setfattr {-n name [-v value] | -x name} &lt;path&gt;]
        [-setrep [-R] [-w] &lt;rep&gt; &lt;path&gt; ...]
        [-stat [format] &lt;path&gt; ...]
        [-tail [-f] &lt;file&gt;]
        [-test -[defsz] &lt;path&gt;]
        [-text [-ignoreCrc] &lt;src&gt; ...]
        [-touchz &lt;path&gt; ...]
        [-usage [cmd ...]]
</code></pre></div></div>

<ul>
  <li>hadoop fs -ls/ æŸ¥çœ‹æ–‡ä»¶åˆ—è¡¨</li>
  <li>ä¸Šä¼ æ–‡ä»¶åˆ°HDFS
    <ol>
      <li>hadoop fs -copyFromLocal LICENSE.txt / ä¸Šä¼ æ–‡ä»¶</li>
      <li>hadoop fs -moveFromLocal LICENSE.txt / ä¸Šä¼ æ–‡ä»¶,æœ¬åœ°çš„å°±æ²¡äº†</li>
      <li>hadoop fs -put ReadMe.md / å°†ReadMe.mdæ–‡ä»¶ä¸Šä¼ åˆ°HDFSçš„æ ¹ç›®å½•</li>
    </ol>
  </li>
  <li>ä¸‹è½½æ–‡ä»¶
    <ol>
      <li>hadoop fs -get /ReadMe.md</li>
      <li>hadoop fs -getmerge /hdfs-test ./t.txt æŠŠå‡ ä¸ªæ–‡ä»¶å’Œæˆä¸€ä¸ªæ–‡ä»¶ä¸‹è½½</li>
    </ol>
  </li>
  <li>hadoop fs -cat /ReadMe.md è¯»å–æ ¹ç›®å½•ä¸‹çš„ReadMe.mdæ–‡ä»¶(/ ä¸èƒ½å°‘)</li>
  <li>hadoop fs -text /ReadMe.md è¯»å–</li>
  <li>hadoop fs -mkdir /hdfs-test åˆ›å»ºç›®å½•</li>
  <li>hadoop fs -mv /ReadMe.md /hdfs-test</li>
  <li>hadoop fs -cp /hdfs-test/README.txt /hdfs-test/ReadMe.txt_back æ‹·è´æ–‡ä»¶</li>
  <li>hadoop fs -rm / åˆ é™¤å•ä¸ªæ–‡ä»¶</li>
  <li>hadoop fs -rmdir /hdfs-test åˆ é™¤ä¸ä¸ºç©ºçš„ç›®å½•</li>
  <li>hadoop fs -rmr /hdfs-test = hadoop fs -rm -rf /hdfs-test åˆ é™¤ç›®å½•</li>
  <li>hadoop fs -ls -R /hdfsapi/test é€’å½’å±•ç¤ºä¸‹é¢æ‰€æœ‰æ–‡ä»¶åŠæ–‡ä»¶å¤¹</li>
  <li>hadoop fs -ls  == hadoop fs -ls /usr/hadoop/</li>
  <li>HDFSå­˜å‚¨æ‰©å±•
    <ol>
      <li>1file ==&gt; 1â€¦n block ==&gt; å­˜æ”¾åœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Š</li>
      <li>æ–‡ä»¶å­˜æ”¾ç›®å½•(/home/hadoop/app/tmp/dfs/data/current/BP-1458152468-127.0.0.1-1559113660087/current/finalized/subdir0/subdir0)</li>
      <li>å°†æ‰€æœ‰çš„å—æŒ‰ç…§é¡ºåºæ‰“åŒ…ä¸‹æ¥ cat block001 testfile, cat blockoo1 testfileâ€¦   åç»­testfileæ˜¯ä¸€ä¸ªå®Œæ•´çš„æ–‡ä»¶</li>
    </ol>
  </li>
</ul>
:ET