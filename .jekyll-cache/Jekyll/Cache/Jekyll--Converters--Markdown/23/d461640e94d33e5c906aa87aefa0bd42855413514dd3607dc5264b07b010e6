I"<h4 id="æ­å»ºæœ¬åœ°docker-hub-ä»“åº“">æ­å»ºæœ¬åœ°docker hub ä»“åº“</h4>

<ul>
  <li>ç§æœ‰ä»“åº“æœåŠ¡å™¨æ‰§è¡Œ</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>åˆ›å»ºç”¨æˆ·

ä¸ºç”¨æˆ·åˆ›å»ºä¸€ä¸ªå¸¦æœ‰ä¸€ä¸ªæ¡ç›®çš„å¯†ç æ–‡ä»¶testuserï¼Œå¯†ç ä¸º testpasswordï¼š

$ mkdir auth
$ docker run   --entrypoint htpasswd   registry -Bbn dockerpull ypazl1314 &gt; /auth/htpasswd
</code></pre></div></div>

<p>å¯åŠ¨</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo docker run -d  \
-v /opt/docker/registry:/var/lib/registry \
-p 15000:5000 --restart=always \
--privileged=true \
--name registry \
-v /auth:/auth \
-e "REGISTRY_AUTH=htpasswd" \
-e "REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm" \
-e REGISTRY_AUTH_HTPASSWD_PATH=/auth/htpasswd \

registry:latest

</code></pre></div></div>

<p>å‚æ•°è¯´æ˜ï¼š</p>

<ul>
  <li>
    <p>-v /opt/docker/registry:/var/lib/registry é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šå°†ä»“åº“å­˜æ”¾äºå®¹å™¨å†…çš„/var/lib/registryç›®å½•ä¸‹ï¼ŒæŒ‡å®šæœ¬åœ°ç›®å½•æŒ‚è½½åˆ°å®¹å™¨ã€‚</p>
  </li>
  <li>
    <p>-p 5000:5000 ç«¯å£æ˜ å°„</p>
  </li>
  <li>
    <p>â€“restart=always åœ¨å®¹å™¨é€€å‡ºæ—¶æ€»æ˜¯é‡å¯å®¹å™¨,ä¸»è¦åº”ç”¨åœ¨ç”Ÿäº§ç¯å¢ƒ</p>
  </li>
  <li>
    <p>â€“privileged=true</p>
  </li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>åœ¨CentOS7ä¸­çš„å®‰å…¨æ¨¡å—selinuxæŠŠæƒé™ç¦æ‰äº†ï¼Œå‚æ•°ç»™å®¹
å™¨åŠ ç‰¹æƒï¼Œä¸åŠ ä¸Šä¼ é•œåƒä¼šæŠ¥æƒé™é”™è¯¯OSError:[Errno 13] Permission denied: â€˜/tmp/registry/repositories/liibraryâ€™)æˆ–è€…ï¼ˆReceived unexpected HTTP status: 500 Internal Server Errorï¼‰é”™è¯¯
</code></pre></div></div>

<ul>
  <li>â€“name registry æŒ‡å®šå®¹å™¨çš„åç§°</li>
</ul>

<hr />

<h4 id="å…¶ä»–æœåŠ¡å™¨ä¸Šå°†image-pushåˆ°ä»“åº“é‡Œ">å…¶ä»–æœåŠ¡å™¨ä¸Šå°†image pushåˆ°ä»“åº“é‡Œ</h4>

<p>ç™»é™†</p>

<blockquote>
  <p>docker login -u testuser -p testpassword         192.168.1.163:5000</p>
</blockquote>

<p>æ„å»ºé•œåƒ</p>
<blockquote>
  <p>docker build -t ç§æœ‰ä»“åº“åœ°å€ï¼šç«¯å£/imageåç§°</p>
</blockquote>

<p>æäº¤</p>
<blockquote>
  <p>docker push</p>
</blockquote>

<p>æŠ¥é”™è§£å†³</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1.ä½¿ç”¨çš„æœåŠ¡å™¨ä¸Šé…ç½®

è¿›å…¥dockerå®‰è£…ç›®å½•  /etc/docker,æ‰¾åˆ°daemon.json æ·»åŠ ä¿¡ä»»

{"insecure-registries":["10.75.44.222:5000"]}

2 sudo vim /lib/systemd/system/docker.service

åœ¨ [Service] ä¸‹é¢æ·»åŠ 

EnvironmentFile=-/etc/docker/daemon.json

4.è§£å†³httpsæŠ¥é”™é—®é¢˜

ä¿®æ”¹é…ç½®ï¼Œè§£å†³HTTPSè¯ä¹¦æŠ¥é”™é—®é¢˜ï¼ˆä¸å¸¸ç”¨é…ç½®ï¼‰
ä¿®æ”¹/etc/sysconfig/dockerï¼ˆUbuntuä¸‹é…ç½®æ–‡ä»¶åœ°å€ä¸ºï¼š/etc/init/docker.confï¼‰ï¼Œå¢åŠ å¯åŠ¨é€‰é¡¹(å·²æœ‰å‚æ•°çš„åœ¨åé¢è¿½åŠ )ï¼Œä¹‹åé‡å¯dockerï¼Œä¸æ·»åŠ æŠ¥é”™ï¼Œhttpsè¯ä¹¦é—®é¢˜ã€‚

OPTIONS='--insecure-registry 10.0.11.151:5000'    #CentOS 7ç³»ç»Ÿ
other_args='--insecure-registry 10.0.11.151:5000' #CentOS 6ç³»ç»Ÿ
å› ä¸ºDockerä»1.3.Xä¹‹åï¼Œä¸docker registryäº¤äº’é»˜è®¤ä½¿ç”¨çš„æ˜¯httpsï¼Œè€Œæ­¤å¤„æ­å»ºçš„ç§æœ‰ä»“åº“åªæä¾›httpæœåŠ¡


</code></pre></div></div>

<p>æŸ¥çœ‹é•œåƒä»“åº“ä¸Šä¼ çš„é•œåƒ</p>

<p>http://é•œåƒä»“åº“ip:ç«¯å£/v2/_catalog</p>

<h4 id="èº«ä»½éªŒè¯">èº«ä»½éªŒè¯</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ mkdir auth
$ docker run \
  --entrypoint htpasswd \
  registry:2 -Bbn testuser testpassword &gt; auth/htpasswd
</code></pre></div></div>

<h3 id="harboré…ç½®">Harboré…ç½®</h3>

<h4 id="å®‰è£…">å®‰è£…</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ wget https://github.com/vmware/harbor/releases/download/v1.1.2/harbor-online-installer-v1.1.2.tgz

$ tar xvf harbor-online-installer-v1.1.2.tgz


å®‰è£…ä¸äº†å°†https æ¢æˆ http
</code></pre></div></div>

<h4 id="é…ç½®">é…ç½®</h4>

<ol>
  <li>docker-compose.yml
    <blockquote>
      <p>é…ç½®ç«¯å£æ˜ å°„
å°†80 æ”¹ä¸º 1180 å°†443 æ”¹ä¸º1443</p>
    </blockquote>
  </li>
  <li>harbor.cfg</li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>é…ç½®https

hostname = registry.sccdnb.xyz:1443
ui_url_protocol = https
customize_crt = off
ssl_cert = /data/cert/server.crt
ssl_cert_key = /data/cert/server.key

ç¼–è¯‘
./install.sh

</code></pre></div></div>

<h4 id="ä½¿ç”¨">ä½¿ç”¨</h4>

<ol>
  <li>è·å–
    <blockquote>
      <p>docker pull registry.sccdnb.xyz:1443/codechain/hello-world:latest</p>
    </blockquote>
  </li>
  <li>push
    <blockquote>
      <p>docker tag SOURCE_IMAGE[:TAG] registry.sccdnb.xyz:1443/codechain/IMAGE[:TAG]</p>
    </blockquote>

    <blockquote>
      <p>docker push registry.sccdnb.xyz:1443/codechain/IMAGE[:TAG]</p>
    </blockquote>
  </li>
</ol>
:ET