I"î"<h3 id="docker-ç½‘ç»œ">Docker ç½‘ç»œ</h3>

<h4 id="ping-telnet">ping telnet</h4>
<p>ping éªŒè¯IPçš„å¯è¾¾æ€§</p>

<p>telnet æ£€æŸ¥æœåŠ¡çš„å¯ç”¨æ€§</p>

<p>å®‰è£…telnet</p>
<ol>
  <li>yum install telnet-server</li>
  <li>yum install telnet</li>
</ol>

<p>telnet 127.0.0.1 8080</p>

<h4 id="linux-ç½‘ç»œå‘½åç©ºé—´">Linux ç½‘ç»œå‘½åç©ºé—´</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>æ·»åŠ 

ip netns add test1

æŸ¥çœ‹

ip netns list

åˆ é™¤

ip netns delete

æŸ¥çœ‹ä¿¡æ¯

ip netns exec test1 ip a ï¼ˆåŒ…å«ç«¯å£ä¿¡æ¯ï¼‰

ip netns exec test1 ip link (linkä¿¡æ¯)

å¯åŠ¨

ip netns exec test1 ip link set dev lo up

</code></pre></div></div>

<h4 id="é€šè®¯æ¨¡å¼">é€šè®¯æ¨¡å¼</h4>

<ul>
  <li>
    <p>ç¬¬ä¸€æ­¥ï¼š</p>

    <p>åˆ›å»º
  ip netns add test1
  ip netns add test2</p>
  </li>
  <li>
    <p>ç¬¬äºŒæ­¥ï¼š</p>

    <p>æœ¬æœºæ·»åŠ ä¸€å¯¹link</p>

    <p>ip link add veth-test1 type veth peer name veth-test2</p>
  </li>
  <li>
    <p>ç¬¬ä¸‰æ­¥ï¼š</p>

    <p>å°†ç”Ÿæˆçš„linkæ·»åŠ åˆ°å‰é¢åˆ›å»ºçš„test1å’Œtest2</p>

    <p>ip link set veth-test1 netns test1</p>

    <p>ip link set veth-test2 netns test2</p>
  </li>
  <li>
    <p>ç¬¬å››æ­¥ï¼š</p>

    <p>ä¸ºtest1 å’Œ test2 æ·»åŠ  ipåœ°å€</p>

    <p>ip netns exec test1 ip addr add 192.168.1.1/24 dev veth-test1</p>

    <p>ip netns exec test2 ip addr add 192.168.1.2/24 dev veth-test2</p>
  </li>
  <li>
    <p>ç¬¬äº”æ­¥ï¼š</p>

    <p>å¯åŠ¨test1 å’Œ test2</p>

    <p>ip netns exec test1 ip link set dev veth-test1 up</p>

    <p>ip netns exec test2 ip link set dev  veth-test2 up</p>
  </li>
  <li>
    <p>ç¬¬å…­æ­¥ï¼š</p>

    <p>ip netns exec test1 ping 192.168.0.2</p>

    <p>èƒ½å¤Ÿè¿æ¥æˆåŠŸ è¿™ä¸ªå¤§æ¦‚å°±æ˜¯docker å®¹å™¨é—´é€šè®¯çš„æ–¹å¼</p>
  </li>
</ul>

<h4 id="docker-ç½‘ç»œbridge-host-none">docker ç½‘ç»œ(bridge host none)</h4>

<p>æŸ¥çœ‹ç½‘ç»œæƒ…å†µ</p>

<p>docker network ls</p>

<p>bridge ä¸ºå†…éƒ¨ä½¿ç”¨</p>

<p>host ä¸ºå¤–éƒ¨ä½¿ç”¨</p>

<p>docker network inspect brigeç½‘ç»œid</p>

<p>å®‰è£…
yum install bridge-utils</p>

<p>brctl show</p>

<p>æœ‰ä¸€ä¸ªå®¹å™¨ å°±ä¼šæœ‰ä¸€ä¸ªè¿åˆ°docker çš„çº¿è·¯</p>

<p>æ‰€æœ‰çš„å®¹å™¨éƒ½æ˜¯ç—›æ®´docker0è¿›è¡Œé€šè®¯çš„</p>

<p>åˆ›å»ºè¿æ¥ (ä¸ç»å¸¸ä½¿ç”¨)</p>

<p>docker run -d â€“name=test2 â€“link test1  busybox /bin/sh -c â€œwhile true;do sleep 3600;doneâ€</p>

<p>è¿™é‡Œ â€“link test1 å°±å¯ä»¥ç›´æ¥ä½¿ç”¨</p>

<h4 id="è®©å®¹å™¨ä¹‹é—´èƒ½å¤Ÿä¸åŠ linkç›´æ¥pingé€š">è®©å®¹å™¨ä¹‹é—´èƒ½å¤Ÿä¸åŠ linkç›´æ¥pingé€š</h4>

<p>1.åˆ›å»ºè‡ªåŠ¨ç½‘ç»œé›†
    docker network create -d bridge my-bridge</p>

<p>2.å¯åŠ¨çš„æ—¶å€™æŒ‡å®š</p>

<blockquote>
  <p>docker run -d â€“name=test3 â€“network my-bridge  busybox /bin/sh -c â€œwhile true;do sleep 3600;doneâ€</p>
</blockquote>

<p>æˆ–è€…å°†å·²ç»å»ºç«‹äº†é»˜è®¤çš„ç½‘ç»œè¿æ¥åˆ°è‡ªå®šä¹‰çš„ç½‘ç»œ</p>

<blockquote>
  <p>docker network connect my-bridge test2</p>
</blockquote>

<h4 id="ç«¯å£æ˜ å°„">ç«¯å£æ˜ å°„</h4>

<p>é€šè¿‡ -p  æŒ‡å®š</p>

<blockquote>
  <p>docker run â€“name web -d -p 9069:80 nginx</p>
</blockquote>

<h4 id="nonehost-ç½‘ç»œ">noneã€host ç½‘ç»œ</h4>

<p>docker run -d â€“name test â€“network none busybox /bin/sh -c â€œwhile true;do sleep 3600;doneâ€</p>

<p>å’Œæœ¬æœºå®Œå…¨ä¸€æ ·çš„ç½‘ç»œ
docker run -d â€“name test â€“network host busybox /bin/sh -c â€œwhile true;do sleep 3600;doneâ€</p>

<h4 id="å¯åŠ¨æ—¶æŒ‡å®šç¯å¢ƒå˜é‡--e">å¯åŠ¨æ—¶æŒ‡å®šç¯å¢ƒå˜é‡ -e</h4>
<p>docker run -d â€“link redis â€“name flsk-redis -e REDIS_HOST=redis yangping/flask-redis</p>

<h4 id="å¤šæœºå™¨é€šä¿¡-etcd">å¤šæœºå™¨é€šä¿¡ (etcd)</h4>

<p>é™¤bridgeã€hostã€noneä¹‹å¤–çš„ç½‘ç»œ overlay</p>

<p>ä½¿ç”¨ â€“net æŒ‡å®šç½‘ç»œ</p>

<h4 id="docker-æŒä¹…åŒ–æ•°æ®">Docker æŒä¹…åŒ–æ•°æ®</h4>

<ol>
  <li>åŸºäºæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„Volume
 1.1 å—ç®¡ç†çš„data Volume ç”±dockeråå°è‡ªåŠ¨åˆ›å»º
 1.2 ç»‘å®šæŒ‚è½½çš„Volumeï¼ŒæŒ‚è½½ä½ç½®ç”±ç”¨æˆ·æŒ‡å®š</li>
  <li>ç¬¬ä¸‰æ–¹å­˜å‚¨ å¦‚aws</li>
</ol>

<p>Volume ä½¿ç”¨</p>

<p>åœ¨dockerfile ä¸­ ä½¿ç”¨å…³é”®å­— volume æŒ‡å®šæœ¬åœ°æ˜ å°„è·¯å¾„</p>

<p>æŸ¥çœ‹æ‰€æœ‰çš„volume</p>

<p>docker volume ls</p>

<p>åˆ›å»ºçš„volumeçš„åå­—ä¸å¤ªå‹å¥½ï¼Œéœ€æŒ‡å®š</p>

<p>-v è‡ªå®šä¹‰åç§°:volumeæ˜ å°„çš„æœ¬åœ°è·¯å¾„</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run -d -v mysql:/var/lib/mysql --name mysql2 -e MYSQL_ALLOW_EMPTY_PASSWORD=true mysql
</code></pre></div></div>

<p>æŠŠå½“å‰å®¹å™¨åˆ é™¤æ‰ï¼Œåç»­åˆ›å»ºæ–°çš„å®¹å™¨ -v æŒ‡å®šçš„å’Œä¸Šè¿°ç›¸åŒï¼Œåˆ™ä¼šæ•°æ®å…±äº«</p>

<p>Bind Mouting(ä¸éœ€è¦åœ¨dockerfileæŒ‡å®švolume)</p>

<p>docker run -v /home/aaa:/root/aaa</p>

<h3 id="docker-swarm">Docker Swarm</h3>

<h4 id="docker-swarm-1">docker swarm</h4>

<ul>
  <li>åˆ›å»ºèŠ‚ç‚¹
    <ol>
      <li>
        <p>åˆ›å»ºmaneger
  docker swarm init â€“advertise-addr=192.168.0.2</p>
      </li>
      <li>
        <p>ä¼šç”Ÿæˆä¸€ä¸ªtokenï¼Œåœ¨éœ€è¦è®¾ç½®ä¸ºworkerçš„èŠ‚ç‚¹ä¸Šæ‰§è¡Œ docker swarm join -token SWMTKEN-1-3xxxx 192.168.0.0:2377</p>
      </li>
    </ol>
  </li>
  <li>
    <p>æŸ¥çœ‹å½“å‰swarmçš„èŠ‚ç‚¹  docker node  ls</p>
  </li>
  <li>åˆ›å»ºservice
```
docker service create â€“name demo busybox sh -c â€œwhile true;do sleep 3600;doneâ€</li>
</ul>

<p>æŸ¥çœ‹service</p>

<p>docker service ls</p>

<p>docker service ps demo</p>

<p>æ¨ªå‘æ‰©å±•</p>

<p>docker service scale demo=5</p>

<p>ä¼šåœ¨èŠ‚ç‚¹ä¸­åˆ†é…å¹¶å¯åŠ¨5ä¸ªæœåŠ¡ï¼Œè‹¥æŸä¸€æœåŠ¡æŒ‚æ‰äº†ï¼Œä¼šé‡æ–°å¯åŠ¨ä¸€ä¸ª</p>

<p>åˆ é™¤</p>

<p>docker service rm demo</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
==åªæœ‰managerèŠ‚ç‚¹æ‰èƒ½ç”¨ docker service çš„å‘½ä»¤==

#### æ„å»º wordpress

- åˆ›å»ºoverlayç½‘ç»œ
    1.docker network create -d overlay demo
- åˆ›å»ºmysqlæœåŠ¡
    &gt;docker service create --name mysql --env MYSQL_ROOT_PASSWORD=root --env MYSQL_DATABASE=wordpress --network demo --mount type=volume,source=mysql-data,destination=/var/lib/mysql mysql

- åˆ›å»ºwordpressæœåŠ¡
    &gt;docker service create --name wordpress -p 80:80 --env WORDPRESS_DB_PASSWORD=root --env WORDPRESS_DB_HOST=mysql --network demo wordpress

åˆ›å»ºè¿‡å è®¿é—®manageræˆ–èŠ‚ç‚¹çš„ipéƒ½èƒ½è®¿é—®åˆ°æœåŠ¡

#### docker swarm ç½‘ç»œ

- åˆ›å»ºä¸€ä¸ªè¿”å›æœåŠ¡ipçš„æœåŠ¡
    &gt; docker service create --name whoami -p 8000:8000 --network demo -d jwilder/whoami

- æŸ¥çœ‹DNS    nslookup www.baidu.com



#### ç±»ä¼¼docker-composeéƒ¨ç½²

é…ç½®æ–‡ä»¶

</code></pre></div></div>
<p>version: â€˜3â€™  # order å¿…é¡»è¦3.4ä»¥ä¸Š</p>

<p>services:</p>

<p>web:
    image: wordpress
    ports:
      - 8080:80
    secrets:
      - my-pw
    environment:
      WORDPRESS_DB_HOST: mysql
      WORDPRESS_DB_PASSWORD_FILE: /run/secrets/my-pw
    networks:
      - my-network
    depends_on: # ä¾èµ–äºæŸä¸ªæœåŠ¡ï¼Œéœ€è¦å…ˆåˆ›å»ºæ­¤æœåŠ¡
      - mysql
    deploy:
      mode: replicated  #å¯æ‰©å±•
      replicas: 3  # å¯åŠ¨3ä¸ªæœåŠ¡
      restart_policy: # é‡å¯çš„è§„åˆ™
        condition: on-failure
        delay: 5s
        max_attempts: 3
      update_config: # æ›´æ–°çš„è§„åˆ™
        parallelism: 1
        delay: 10s</p>

<p>mysql:
    image: mysql
    secrets:
      - my-pw
    environment:
      MYSQL_ROOT_PASSWORD_FILE: /run/secrets/my-pw
      MYSQL_DATABASE: wordpress
    volumes:
      - mysql-data:/var/lib/mysql
    networks:
      - my-network
    deploy:
      mode: global
      placement:
        constraints:
          - node.role == manager</p>

<p>volumes:
  mysql-data:</p>

<p>networks:
  my-network:
    driver: overlay</p>

<h1 id="secrets">secrets:</h1>
<h1 id="my-pw">my-pw:</h1>
<h1 id="file-password">file: ./password</h1>
<p>```</p>

<p>docker stack å‘½ä»¤</p>

<ul>
  <li>deploy
    <blockquote>
      <p>docker stack deploy æœåŠ¡åç§° â€“compose-file=æ–‡ä»¶åç§°</p>
    </blockquote>
  </li>
  <li>ls</li>
  <li>ps</li>
  <li>rm</li>
  <li>services</li>
</ul>

<h4 id="docker-secret">docker secret</h4>

<p>åº”ç”¨docker manager èŠ‚ç‚¹çš„åˆ†å¸ƒå¼å­˜å‚¨é‡Œé¢</p>

<ul>
  <li>å­˜åœ¨swarm manager èŠ‚ç‚¹çš„Raft database é‡Œé¢</li>
  <li>secret å¯ä»¥assignç»™ä¸€ä¸ªserviceï¼Œè¿™ä¸ªserviceå°±èƒ½çœ‹åˆ°è¿™ä¸ªsecret</li>
  <li>
    <p>åœ¨containerå†…éƒ¨secretçœ‹èµ·æ¥å°±åƒæ–‡ä»¶ï¼Œä½†æ˜¯å®é™…åœ¨å†…å­˜ä¸­</p>
  </li>
  <li>åˆ›å»º docker secret create
    <ol>
      <li>ä»æ–‡ä»¶ä¸­åˆ›å»º
        <blockquote>
          <p>docker secret create my-pw æ–‡ä»¶å</p>
        </blockquote>
      </li>
      <li>æ ‡å‡†è¾“å…¥ä¸­åˆ›å»º
        <blockquote>
          <table>
            <tbody>
              <tr>
                <td>echo â€˜adminadminâ€™</td>
                <td>docker secret create my-pw2 -</td>
              </tr>
            </tbody>
          </table>
        </blockquote>
      </li>
    </ol>
  </li>
  <li>æŸ¥çœ‹ docker secret ls</li>
  <li>åˆ é™¤ docker secret rm åç§°</li>
</ul>

<p>-ä½¿ç”¨ å¯åŠ¨serviceçš„æ—¶å€™æŒ‡å®š â€“secret mypwd
    &gt;è¿›å…¥åˆ°èŠ‚ç‚¹ä¸­åœ¨ /run/secretsé‡Œé¢å°±ä¼šæœ‰è¿™ä¸ªæ–‡ä»¶ï¼Œå†…å®¹å°±æ˜¯å¯†ç </p>
:ET